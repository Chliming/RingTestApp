# 环形测试应用程序 (Ring Test Application)

## 项目概述

本项目是一个基于WPF的环形测试应用程序，用于控制MC-N01C/02C/03C控制器进行精密位置测试。应用程序通过Modbus RTU协议与控制器通信，实现自动化的循环位置测试。

## 项目结构

```
RingTestApp/
├── Communications/              # 通信层
│   └── ModbusControllerCommunicator.cs
├── Interfaces/                  # 接口定义
│   └── IControllerCommunicator.cs
├── Models/                      # 数据模型
│   ├── ControllerStatus.cs
│   └── TestDataPoint.cs
├── Services/                    # 业务服务
│   └── DataLogger.cs
├── ViewModels/                  # 视图模型
│   └── MainViewModel.cs
├── Views/                       # 用户界面
│   ├── MainWindow.xaml
│   └── MainWindow.xaml.cs
├── App.xaml                     # 应用程序入口
├── App.xaml.cs
├── AssemblyInfo.cs
└── RingTestApp.csproj          # 项目文件
```

## 架构设计

### 分层架构

1. **表示层 (Views)**
   - 负责用户界面的显示和交互
   - 使用MVVM模式与业务逻辑分离

2. **视图模型层 (ViewModels)**
   - 实现MVVM模式的ViewModel
   - 处理UI逻辑和数据绑定
   - 协调各个服务组件

3. **业务服务层 (Services)**
   - 数据记录和导出服务
   - 业务逻辑处理

4. **通信层 (Communications)**
   - 实现与控制器的通信协议
   - Modbus RTU协议封装

5. **数据模型层 (Models)**
   - 定义数据结构
   - 状态信息和测试数据点

6. **接口层 (Interfaces)**
   - 定义组件间的契约
   - 支持依赖注入和单元测试

## 主要功能

### 连接管理
- 自动检测可用串口
- 支持手动刷新端口列表
- 可配置波特率和连接参数

### 测试控制
- 三点位置循环测试
- 可配置测试参数（位置、速度、循环次数等）
- 实时状态监控
- 误差窗检测

### 数据记录
- 实时数据采集
- 测试数据导出（CSV格式）
- 错误日志记录和导出
- 数据清除功能

### 用户界面
- 直观的参数设置面板
- 实时状态显示
- 系统日志输出
- 响应式布局设计

## 技术栈

- **.NET 8.0** - 应用程序框架
- **WPF** - 用户界面框架
- **MVVM模式** - 架构模式
- **NModbus** - Modbus通信库
- **System.IO.Ports** - 串口通信

## 使用说明

### 环境要求
- Windows 10/11
- .NET 8.0 Runtime
- 可用的串口（用于连接控制器）

### 安装步骤
1. 确保已安装.NET 8.0 Runtime
2. 下载并解压应用程序
3. 连接MC-N01C/02C/03C控制器到计算机
4. 运行RingTestApp.exe

### 操作流程
1. **连接设置**
   - 点击"刷新"按钮检测可用端口
   - 选择正确的串口号
   - 确认波特率设置（默认460800）

2. **参数配置**
   - 设置三个测试位置（μm）
   - 配置循环次数和停留时间
   - 设置运动速度和误差窗
   - 调整采样频率

3. **开始测试**
   - 点击"开始"按钮启动测试
   - 监控实时状态信息
   - 观察系统日志输出

4. **数据管理**
   - 测试完成后导出数据
   - 查看和导出错误日志
   - 清除历史数据

## 配置说明

### 默认参数
- 端口号：COM3
- 波特率：460800
- 位置1：0 μm
- 位置2：50000 μm
- 位置3：100000 μm
- 循环次数：100
- 停留时间：1秒
- 运动速度：10 mm/s
- 误差窗：500 nm
- 采样频率：100 Hz

### 数据导出
- 测试数据：CSV格式，包含时间戳、位置、速度、误差等信息
- 错误日志：TXT格式，包含详细的错误信息和时间戳
- 导出位置：用户文档/RingTestApp/Logs/

## 故障排除

### 常见问题
1. **无法检测到串口**
   - 检查控制器连接
   - 确认驱动程序已安装
   - 尝试手动刷新端口列表

2. **连接失败**
   - 验证端口号和波特率
   - 检查串口是否被其他程序占用
   - 确认控制器电源状态

3. **数据异常**
   - 检查Modbus通信参数
   - 验证控制器固件版本
   - 查看错误日志获取详细信息

## 开发说明

### 代码规范
- 使用C# 12.0语法特性
- 遵循SOLID原则
- 采用异步编程模式
- 完整的XML文档注释

### 扩展开发
- 实现IControllerCommunicator接口支持其他通信协议
- 继承DataLogger类添加自定义数据处理
- 扩展ViewModel添加新的业务功能

### 单元测试
- 接口设计支持依赖注入
- 可模拟通信层进行测试
- 业务逻辑与UI完全分离

## 版本历史

### v2.0.0 (当前版本)
- 重构项目架构，采用分层设计
- 实现MVVM模式
- 添加端口自动检测功能
- 优化用户界面布局
- 完善错误处理和日志记录

### v1.0.0
- 基础功能实现
- Modbus RTU通信
- 简单的数据记录

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

如有问题或建议，请联系开发团队。